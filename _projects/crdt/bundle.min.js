!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(1),e.exports=n(5)},function(e,t,n){var r=n(2);"string"==typeof r&&(r=[[e.i,r,""]]);n(4)(r,{insert:"head",singleton:!1}),r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,"body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}#root{display:flex}.App{text-align:center;flex:1 1;width:50%}.App-logo{height:40vmin}.App-header{background-color:#282c34;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:calc(10px + 2vmin);color:#fff}.App-link{color:#09d3ac}",""])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),s=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(s).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(i=0;i<e.length;i++){var a=e[i];null!=a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){"use strict";var r,i,s={},a=(i={},function(e){if(void 0===i[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}i[e]=t}return i[e]});function o(e,t){for(var n=[],r={},i=0;i<e.length;i++){var s=e[i],a=t.base?s[0]+t.base:s[0],o={css:s[1],media:s[2],sourceMap:s[3]};r[a]?r[a].parts.push(o):n.push(r[a]={id:a,parts:[o]})}return n}function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=s[r.id],a=0;if(i){for(i.refs++;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(g(r.parts[a],t))}else{for(var o=[];a<r.parts.length;a++)o.push(g(r.parts[a],t));s[r.id]={id:r.id,refs:1,parts:o}}}}function c(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var r=n.nc;r&&(e.attributes.nonce=r)}if(Object.keys(e.attributes).forEach((function(n){t.setAttribute(n,e.attributes[n])})),"function"==typeof e.insert)e.insert(t);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var u,l=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function h(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=l(t,i);else{var s=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}var p=null,f=0;function g(e,t){var n,r,i;if(t.singleton){var s=f++;n=p=p||c(t),r=h.bind(null,n,s,!1),i=h.bind(null,n,s,!0)}else n=c(t),r=function(e,t,n){var r=n.css,i=n.media,s=n.sourceMap;if(i&&e.setAttribute("media",i),s&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,n,t),i=function(){!function(e){null!==e.parentNode&&e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=o(e,t);return d(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var a=n[i],c=s[a.id];c&&(c.refs--,r.push(c))}e&&d(o(e,t),t);for(var u=0;u<r.length;u++){var l=r[u];if(0===l.refs){for(var h=0;h<l.parts.length;h++)l.parts[h]();delete s[l.id]}}}}},function(e,t){(this["webpackJsonpcrdt-editor"]=this["webpackJsonpcrdt-editor"]||[]).push([[0],{17:function(e,t,n){var r=n(29);function i(e,t,n,r){return e===n?t-r:e-n}t.ZERO_POINT=Object.freeze({row:0,column:0}),t.compare=function(e,t){return i(e.row,e.column,t.row,t.column)},t.traverse=function(e,t){return 0===t.row?{row:e.row,column:e.column+t.column}:{row:e.row+t.row,column:t.column}},t.traversal=function(e,t){return e.row===t.row?{row:0,column:e.column-t.column}:{row:e.row-t.row,column:e.column}},t.extentForText=function(e){for(var t=0,n=0,r=0;r<e.length;)"\n"===e[r]?(n=0,t++):n++,r++;return{row:t,column:n}},t.characterIndexForPosition=function(e,t){for(var n=0,s=0,a=0;i(n,s,t.row,t.column)<0&&a<=e.length;)"\n"===e[a]?(n++,s=0):s++,a++;return r(i(n,s,t.row,t.column)<=0,"Target position should not exceed the extent of the given text"),a}},30:function(e,t,n){"use strict";n.r(t),function(e){var t=n(0),r=n(2);function i(){Object(t.a)(this,i)}e.exports=(Object(r.a)(i,[{key:"splayNode",value:function(e){if(e)for(;;)if(this.isNodeLeftChild(this.getParent(e))&&this.isNodeRightChild(e))this.rotateNodeLeft(e),this.rotateNodeRight(e);else if(this.isNodeRightChild(this.getParent(e))&&this.isNodeLeftChild(e))this.rotateNodeRight(e),this.rotateNodeLeft(e);else if(this.isNodeLeftChild(this.getParent(e))&&this.isNodeLeftChild(e))this.rotateNodeRight(this.getParent(e)),this.rotateNodeRight(e);else{if(!this.isNodeRightChild(this.getParent(e))||!this.isNodeRightChild(e))return void(this.isNodeLeftChild(e)?this.rotateNodeRight(e):this.isNodeRightChild(e)&&this.rotateNodeLeft(e));this.rotateNodeLeft(this.getParent(e)),this.rotateNodeLeft(e)}}},{key:"rotateNodeLeft",value:function(e){var t=this.getParent(e);this.getParent(t)?t===this.getLeft(this.getParent(t))?this.setLeft(this.getParent(t),e):this.setRight(this.getParent(t),e):this.root=e,this.setParent(e,this.getParent(t)),this.setRight(t,this.getLeft(e)),this.getRight(t)&&this.setParent(this.getRight(t),t),this.setLeft(e,t),this.setParent(this.getLeft(e),e),this.updateSubtreeExtent(t),this.updateSubtreeExtent(e)}},{key:"rotateNodeRight",value:function(e){var t=this.getParent(e);this.getParent(t)?t===this.getLeft(this.getParent(t))?this.setLeft(this.getParent(t),e):this.setRight(this.getParent(t),e):this.root=e,this.setParent(e,this.getParent(t)),this.setLeft(t,this.getRight(e)),this.getLeft(t)&&this.setParent(this.getLeft(t),t),this.setRight(e,t),this.setParent(this.getRight(e),e),this.updateSubtreeExtent(t),this.updateSubtreeExtent(e)}},{key:"isNodeLeftChild",value:function(e){return null!=e&&null!=this.getParent(e)&&this.getLeft(this.getParent(e))===e}},{key:"isNodeRightChild",value:function(e){return null!=e&&null!=this.getParent(e)&&this.getRight(this.getParent(e))===e}},{key:"getSuccessor",value:function(e){if(this.getRight(e))for(e=this.getRight(e);this.getLeft(e);)e=this.getLeft(e);else{for(;this.getParent(e)&&this.getRight(this.getParent(e))===e;)e=this.getParent(e);e=this.getParent(e)}return e}}]),i)}.call(this,n(16)(e))},47:function(e,t,n){e.exports=n(97)},52:function(e,t,n){},53:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t),function(e){var t,r=n(0),i=n(2),s=n(6),a=n(5),o=n(7),d=n(30),c=n(17),u=c.ZERO_POINT,l=c.compare,h=c.traverse;function p(e,t,n){var i;return Object(r.a)(this,p),(i=Object(s.a)(this,Object(a.a)(p).call(this))).firstFragment=e,i.firstFragment.documentRight=t,i.firstFragment.documentRight.documentParent=i.firstFragment,i.firstFragment.documentLeft=null,i.firstFragment.documentSubtreeExtent=u,t.documentSubtreeExtent=u,i.root=i.firstFragment,i.isFragmentVisible=n,i}e.exports=(t=d,Object(o.a)(p,t),Object(i.a)(p,[{key:"getFragmentIndex",value:function(e){for(var t=e.documentLeft?e.documentLeft.documentSubtreeSize:0;e.documentParent;)e.documentParent.documentRight===e&&(t++,e.documentParent.documentLeft&&(t+=e.documentParent.documentLeft.documentSubtreeSize)),e=e.documentParent;return t}},{key:"getParent",value:function(e){return e.documentParent}},{key:"setParent",value:function(e,t){e.documentParent=t}},{key:"getLeft",value:function(e){return e.documentLeft}},{key:"setLeft",value:function(e,t){e.documentLeft=t}},{key:"getRight",value:function(e){return e.documentRight}},{key:"setRight",value:function(e,t){e.documentRight=t}},{key:"findFragmentContainingPosition",value:function(e){for(var t=this.root,n=u;t;){var r=n;t.documentLeft&&(r=h(r,t.documentLeft.documentSubtreeExtent));var i=r;if(this.isFragmentVisible(t)&&(i=h(i,t.extent)),l(e,r)<=0&&t!==this.firstFragment)t=t.documentLeft;else{if(!(0<l(e,i)))return{fragment:t,start:r,end:i};n=i,t=t.documentRight}}throw new Error("No fragment found")}},{key:"insertBetween",value:function(e,t,n){this.splayNode(e),this.splayNode(t),((((this.root=n).documentLeft=e).documentParent=n).documentRight=t).documentParent=n,t.documentLeft=null,this.updateSubtreeExtent(t),this.updateSubtreeExtent(n)}},{key:"splitFragment",value:function(e,t){this.splayNode(e),(this.root=t).documentParent=null,((t.documentLeft=e).documentParent=t).documentRight=e.documentRight,t.documentRight&&(t.documentRight.documentParent=t),e.documentRight=null,this.updateSubtreeExtent(e),this.updateSubtreeExtent(t)}},{key:"updateSubtreeExtent",value:function(e,t){e.documentSubtreeExtent=u,e.documentSubtreeSize=1,e.documentLeft&&(e.documentSubtreeExtent=h(e.documentSubtreeExtent,e.documentLeft.documentSubtreeExtent),e.documentSubtreeSize+=e.documentLeft.documentSubtreeSize),this.isFragmentVisible(e,t)&&(e.documentSubtreeExtent=h(e.documentSubtreeExtent,e.extent)),e.documentRight&&(e.documentSubtreeExtent=h(e.documentSubtreeExtent,e.documentRight.documentSubtreeExtent),e.documentSubtreeSize+=e.documentRight.documentSubtreeSize)}},{key:"getFragments",value:function(){var e=[];return function t(n){n.documentLeft&&t(n.documentLeft),e.push(n),n.documentRight&&t(n.documentRight)}(this.root),e}},{key:"getFragmentPosition",value:function(e){return this.splayNode(e),e.documentLeft?e.documentLeft.documentSubtreeExtent:u}}]),p)}.call(this,n(16)(e))},65:function(e,t,n){"use strict";n.r(t),function(e){var t,r=n(0),i=n(2),s=n(6),a=n(5),o=n(7),d=n(30),c=n(17),u=c.ZERO_POINT,l=c.compare,h=c.traverse,p=c.traversal,f=c.characterIndexForPosition;function g(e){var t;return Object(r.a)(this,g),(t=Object(s.a)(this,Object(a.a)(g).call(this))).startFragment=e,t.startFragment.splitLeft=null,t.startFragment.splitRight=null,t.startFragment.splitParent=null,t.startFragment.splitSubtreeExtent=t.startFragment.extent,t.root=t.startFragment,t}e.exports=(t=d,Object(o.a)(g,t),Object(i.a)(g,[{key:"getStart",value:function(){return this.startFragment}},{key:"getParent",value:function(e){return e.splitParent}},{key:"setParent",value:function(e,t){e.splitParent=t}},{key:"getLeft",value:function(e){return e.splitLeft}},{key:"setLeft",value:function(e,t){e.splitLeft=t}},{key:"getRight",value:function(e){return e.splitRight}},{key:"setRight",value:function(e,t){e.splitRight=t}},{key:"updateSubtreeExtent",value:function(e){e.splitSubtreeExtent=u,e.splitLeft&&(e.splitSubtreeExtent=h(e.splitSubtreeExtent,e.splitLeft.splitSubtreeExtent)),e.splitSubtreeExtent=h(e.splitSubtreeExtent,e.extent),e.splitRight&&(e.splitSubtreeExtent=h(e.splitSubtreeExtent,e.splitRight.splitSubtreeExtent))}},{key:"findFragmentContainingOffset",value:function(e){for(var t=this.root,n=u;t;){var r=n;t.splitLeft&&(r=h(r,t.splitLeft.splitSubtreeExtent));var i=h(r,t.extent);if(l(e,r)<=0&&t.splitLeft)t=t.splitLeft;else{if(!(0<l(e,i)))return this.splayNode(t),t;n=i,t=t.splitRight}}throw new Error("No fragment found")}},{key:"splitFragment",value:function(e,t){var n=f(e.text,t);this.splayNode(e);var r=Object.assign({},e);return r.text=e.text.slice(n),r.extent=p(e.extent,t),r.spliceId=Object.assign({},e.spliceId),r.offset=h(r.offset,t),r.deletions=new Set(r.deletions),e.text=e.text.slice(0,n),e.extent=t,e.nextSplit=r,(this.root=r).splitParent=null,((r.splitLeft=e).splitParent=r).splitRight=e.splitRight,r.splitRight&&(r.splitRight.splitParent=r),e.splitRight=null,this.updateSubtreeExtent(e),this.updateSubtreeExtent(r),r}},{key:"getSuccessor",value:function(e){return e.nextSplit}},{key:"getFragments",value:function(){for(var e=[],t=this.getStart();t;)e.push(t),t=t.nextSplit;return e}}]),g)}.call(this,n(16)(e))},94:function(e,t){},97:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),s=n(44),a=n.n(s),o=(n(52),n(0)),d=n(2),c=n(6),u=n(5),l=n(7),h=(n(53),n(45)),p=n.n(h),f=n(12),g=n(8),m=n(29),v=n(64),y=n(65),S=n(17),k=S.ZERO_POINT,I=S.compare,x=S.traverse,b=S.traversal,w=S.extentForText,O=(Object(d.a)(F,[{key:"populateHistory",value:function(e){var t=e.baseText,n=e.nextCheckpointId,r=e.undoStack,i=e.redoStack;this.setTextInRange(k,k,t),this.nextCheckpointId=n;for(var s=[],a=r.concat(i.slice().reverse()),o=0;o<a.length;o++){var d=a[o],c=d.type,u=d.changes,l=d.markersBefore,h=d.markersAfter,p=d.id,f=d.markers;if("transaction"===c){for(var m=[],v=this.snapshotFromMarkers(l),y=u.length-1;0<=y;y--){var S=u[y],I=S.oldStart,x=S.oldEnd,b=S.newText;m.push.apply(m,Object(g.a)(this.setTextInRange(I,x,b)))}var w=this.snapshotFromMarkers(h);s.push(new D(0,m,v,w))}else{if("checkpoint"!==c)throw new Error("Unknown entry type '".concat(c,"'"));s.push(new E(p,!1,this.snapshotFromMarkers(f)))}}this.undoStack=s;for(var O=0;O<i.length;O++)"transaction"===i[O].type&&this.undo()}},{key:"replicate",value:function(e){var t=new F({siteId:e});return t.integrateOperations(this.getOperations()),t}},{key:"getOperations",value:function(){var e=[];return this.markerLayersBySiteId.forEach((function(t,n){var r={};t.forEach((function(e,t){var n={};e.forEach((function(e,t){n[t]=e})),r[t]=n})),e.push({type:"markers-update",updates:r,siteId:n})})),this.operations.concat(e)}},{key:"setTextInRange",value:function(e,t,n){var r={site:this.siteId,seq:this.nextSequenceNumber},i={type:"splice",spliceId:r};return 0<I(t,e)&&(i.deletion=this.delete(r,e,t)),n&&0<n.length&&(i.insertion=this.insert(r,e,n)),this.updateMaxSeqsBySite(r),this.undoStack.push(new D(this.getNow(),[i])),this.clearRedoStack(),this.operations.push(i),[i]}},{key:"getMarkers",value:function(){var e=this,t={};return this.markerLayersBySiteId.forEach((function(n,r){0<n.size&&(t[r]={},n.forEach((function(n,i){t[r][i]={},n.forEach((function(n,s){var a=Object.assign({},n);a.range=e.resolveLogicalRange(n.range,n.exclusive),t[r][i][s]=a}))})))})),t}},{key:"updateMarkers",value:function(e){var t={type:"markers-update",siteId:this.siteId,updates:{}},n=this.markerLayersBySiteId.get(this.siteId);for(var r in e){var i=e[r];r=parseInt(r);var s=n.get(r);if(null===i)s&&(n.delete(r),t.updates[r]=null);else for(var a in s||(s=new Map,n.set(r,s)),t.updates[r]={},i){var o=i[a];a=parseInt(a);var d=s.get(a);if(o){var c=(d=d?Object.assign({},d):{exclusive:!1,reversed:!1,tailed:!0}).exclusive!==o.exclusive;Object.assign(d,o),(o.range||c)&&(d.range=this.getLogicalRange(o.range||d.range,d.exclusive)),Object.freeze(d),s.set(a,d),t.updates[r][a]=d}else s.delete(a),t.updates[r][a]=null}}return[t]}},{key:"undo",value:function(){for(var e,t=null,n=[],r=this.undoStack.length-1;0<=r;r--){var i=this.undoStack[r];if(i instanceof D){n=i.operations,e=i.markersSnapshotBefore,t=r;break}if(i instanceof E&&i.isBarrier)return null}if(null==t)return null;var s;(s=this.redoStack).push.apply(s,Object(g.a)(this.undoStack.splice(t).reverse()));var a=this.undoOrRedoOperations(n);return{operations:a.operations,textUpdates:a.textUpdates,markers:this.markersFromSnapshot(e)}}},{key:"redo",value:function(){for(var e,t=null,n=[],r=this.redoStack.length-1;0<=r;r--){var i=this.redoStack[r];if(i instanceof D){n=i.operations,e=i.markersSnapshotAfter,t=r;break}}for(;this.redoStack[t-1]instanceof E;)t--;if(null==t)return null;var s;(s=this.undoStack).push.apply(s,Object(g.a)(this.redoStack.splice(t).reverse()));var a=this.undoOrRedoOperations(n);return{operations:a.operations,textUpdates:a.textUpdates,markers:e?this.markersFromSnapshot(e):null}}},{key:"clearUndoStack",value:function(){this.undoStack.length=0}},{key:"clearRedoStack",value:function(){this.redoStack.length=0}},{key:"applyGroupingInterval",value:function(e){var t,n=this.undoStack[this.undoStack.length-1],r=this.undoStack[this.undoStack.length-2];n instanceof D&&(n.groupingInterval=e,r instanceof D&&n.timestamp-r.timestamp<Math.min(e,r.groupingInterval||1/0)&&(this.undoStack.pop(),r.timestamp=n.timestamp,r.groupingInterval=e,(t=r.operations).push.apply(t,Object(g.a)(n.operations)),r.markersSnapshotAfter=n.markersSnapshotAfter))}},{key:"getNow",value:function(){return Date.now()}},{key:"createCheckpoint",value:function(e){var t=new E(this.nextCheckpointId++,e&&e.isBarrier,e&&this.snapshotFromMarkers(e.markers));return this.undoStack.push(t),t.id}},{key:"isBarrierPresentBeforeCheckpoint",value:function(e){for(var t=this.undoStack.length-1;0<=t;t--){var n=this.undoStack[t];if(n instanceof E){if(n.id==e)return!1;if(n.isBarrier)return!0}}return!1}},{key:"groupChangesSinceCheckpoint",value:function(e,t){if(this.isBarrierPresentBeforeCheckpoint(e))return!1;var n=this.collectOperationsSinceCheckpoint(e,!0,t&&t.deleteCheckpoint);if(n){var r=n.operations,i=n.markersSnapshot;return 0<r.length?(this.undoStack.push(new D(this.getNow(),r,i,t&&this.snapshotFromMarkers(t.markers))),this.textUpdatesForOperations(r)):[]}return!1}},{key:"revertToCheckpoint",value:function(e,t){if(this.isBarrierPresentBeforeCheckpoint(e))return!1;var n=this.collectOperationsSinceCheckpoint(e,!0,t&&t.deleteCheckpoint);if(n){var r=this.undoOrRedoOperations(n.operations);return{operations:r.operations,textUpdates:r.textUpdates,markers:this.markersFromSnapshot(n.markersSnapshot)}}return!1}},{key:"getChangesSinceCheckpoint",value:function(e){var t=this.collectOperationsSinceCheckpoint(e,!1,!1);return!!t&&this.textUpdatesForOperations(t.operations)}},{key:"collectOperationsSinceCheckpoint",value:function(e,t,n){for(var r=-1,i=[],s=this.undoStack.length-1;0<=s;s--){var a=this.undoStack[s];if(a instanceof E){if(a.id===e){r=s;break}}else{if(!(a instanceof D))throw new Error("Unknown stack entry "+a.constructor.name);i.push.apply(i,Object(g.a)(a.operations))}}if(-1===r)return null;var o=this.undoStack[r].markersSnapshot;return t&&(n||r++,this.undoStack.splice(r)),{operations:i,markersSnapshot:o}}},{key:"groupLastChanges",value:function(){for(var e,t=this.undoStack.length-1;0<=t;t--){var n=this.undoStack[t];if(n instanceof E){if(n.isBarrier)return!1}else{if(e)return this.undoStack.splice(t),this.undoStack.push(new D(this.getNow(),n.operations.concat(e.operations),n.markersSnapshotBefore,e.markersSnapshotAfter)),!0;e=n}}return!1}},{key:"getHistory",value:function(e){for(var t=new Map(this.undoCountsBySpliceId),n=[],r=this.redoStack.length-1;0<=r;r--){var i=this.redoStack[r];if(i instanceof D){var s=this.markersFromSnapshot(i.markersSnapshotBefore),a=this.undoOrRedoOperations(i.operations).textUpdates,o=this.markersFromSnapshot(i.markersSnapshotAfter);n.push({type:"transaction",changes:a,markersBefore:s,markersAfter:o})}else n.push({type:"checkpoint",id:i.id,markers:this.markersFromSnapshot(i.markersSnapshot)});if(n.length===e)break}n.reverse();for(var d=this.redoStack.length-1;d>=this.redoStack.length-n.length;d--){var c=this.redoStack[d];c instanceof D&&this.undoOrRedoOperations(c.operations)}for(var u=[],l=this.undoStack.length-1;0<=l;l--){var h=this.undoStack[l];if(h instanceof D){var p=this.markersFromSnapshot(h.markersSnapshotAfter),f=R(this.undoOrRedoOperations(h.operations).textUpdates),g=this.markersFromSnapshot(h.markersSnapshotBefore);u.push({type:"transaction",changes:f,markersBefore:g,markersAfter:p})}else u.push({type:"checkpoint",id:h.id,markers:this.markersFromSnapshot(h.markersSnapshot)});if(u.length===e)break}u.reverse();for(var m=this.undoStack.length-1;m>=this.undoStack.length-u.length;m--){var v=this.undoStack[m];v instanceof D&&this.undoOrRedoOperations(v.operations)}return this.undoCountsBySpliceId=t,{nextCheckpointId:this.nextCheckpointId,undoStack:u,redoStack:n}}},{key:"delete",value:function(e,t,n){for(var r=B(e),i=this.findLocalFragmentBoundary(t)[1],s=this.findLocalFragmentBoundary(n)[0],a={},o=i;;){var d=a[o.spliceId.site];if((null==d||o.spliceId.seq>d)&&(a[o.spliceId.site]=o.spliceId.seq),o.deletions.add(r),this.documentTree.splayNode(o),this.documentTree.updateSubtreeExtent(o),o===s)break;o=this.documentTree.getSuccessor(o)}var c={spliceId:e,leftDependencyId:i.spliceId,offsetInLeftDependency:i.offset,rightDependencyId:s.spliceId,offsetInRightDependency:x(s.offset,s.extent),maxSeqsBySite:a};return this.deletionsBySpliceId.set(r,c),c}},{key:"insert",value:function(e,t,n){var r=this.findLocalFragmentBoundary(t),i=Object(f.a)(r,2),s=i[0],a=i[1],o={spliceId:e,text:n,extent:w(n),offset:k,leftDependency:s,rightDependency:a,nextSplit:null,deletions:new Set};return this.documentTree.insertBetween(s,a,o),this.splitTreesBySpliceId.set(B(e),new y(o)),{text:n,leftDependencyId:s.spliceId,offsetInLeftDependency:x(s.offset,s.extent),rightDependencyId:a.spliceId,offsetInRightDependency:a.offset}}},{key:"undoOrRedoOperations",value:function(e){for(var t=[],n=new Map,r=0;r<e.length;r++){var i=e[r].spliceId,s=(this.undoCountsBySpliceId.get(B(i))||0)+1;this.updateUndoCount(i,s,n);var a={type:"undo",spliceId:i,undoCount:s};t.push(a),this.operations.push(a)}return{operations:t,textUpdates:this.textUpdatesForOperations(t,n)}}},{key:"isSpliceUndone",value:function(e){var t=e.spliceId,n=this.undoCountsBySpliceId.get(B(t));return null!=n&&!0&n}},{key:"canIntegrateOperation",value:function(e){switch(e.type){case"splice":var t=e.spliceId,n=e.deletion,r=e.insertion;if((this.maxSeqsBySite[t.site]||0)!==t.seq-1)return!1;if(n){if(!this.splitTreesBySpliceId.has(B(n.leftDependencyId))||!this.splitTreesBySpliceId.has(B(n.rightDependencyId)))return!1;for(var i in n.maxSeqsBySite)if(n.maxSeqsBySite[i]>(this.maxSeqsBySite[i]||0))return!1}return!!(!r||this.splitTreesBySpliceId.has(B(r.leftDependencyId))&&this.splitTreesBySpliceId.has(B(r.rightDependencyId)));case"undo":var s=B(e.spliceId);return this.splitTreesBySpliceId.has(s)||this.deletionsBySpliceId.has(s);case"markers-update":return!0;default:throw new Error("Unknown operation type")}}},{key:"integrateOperations",value:function(e){for(var t,n=[],r=0;r<e.length;){var i=e[r++];if("markers-update"!==i.type&&this.operations.push(i),this.canIntegrateOperation(i)){switch(n.push(i),i.type){case"splice":i.deletion&&this.integrateDeletion(i.spliceId,i.deletion),i.insertion&&this.integrateInsertion(i.spliceId,i.insertion),this.updateMaxSeqsBySite(i.spliceId);break;case"undo":t=t||new Map,this.integrateUndo(i,t)}this.collectDeferredOperations(i,e)}else this.deferOperation(i)}return{textUpdates:this.textUpdatesForOperations(n,t),markerUpdates:this.updateMarkersForOperations(n)}}},{key:"collectDeferredOperations",value:function(e,t){var n=this,r=e.spliceId;if(r){var i=B(r),s=this.deferredOperationsByDependencyId.get(i);s&&(s.forEach((function(e){n.canIntegrateOperation(e)&&t.push(e)})),this.deferredOperationsByDependencyId.delete(i))}}},{key:"deferOperation",value:function(e){if("splice"===e.type){var t=e.spliceId,n=e.deletion,r=e.insertion;if(this.addOperationDependency(this.deferredOperationsByDependencyId,{site:t.site,seq:t.seq-1},e),n)for(var i in this.addOperationDependency(this.deferredOperationsByDependencyId,n.leftDependencyId,e),this.addOperationDependency(this.deferredOperationsByDependencyId,n.rightDependencyId,e),n.maxSeqsBySite){var s=n.maxSeqsBySite[i];this.addOperationDependency(this.deferredOperationsByDependencyId,{site:i,seq:s},e)}r&&(this.addOperationDependency(this.deferredOperationsByDependencyId,r.leftDependencyId,e),this.addOperationDependency(this.deferredOperationsByDependencyId,r.rightDependencyId,e))}else{if("undo"!==e.type)throw new Error("Unknown operation type: "+e.type);this.addOperationDependency(this.deferredOperationsByDependencyId,e.spliceId,e)}}},{key:"addOperationDependency",value:function(e,t,n){var r=B(t);if(!this.hasAppliedSplice(t)){var i=e.get(r);i||(i=new Set,e.set(r,i)),i.add(n)}}},{key:"hasAppliedSplice",value:function(e){var t=B(e);return this.splitTreesBySpliceId.has(t)||this.deletionsBySpliceId.has(t)}},{key:"integrateInsertion",value:function(e,t){console.log("integrating insertion");var n=t.text,r=t.leftDependencyId,i=t.offsetInLeftDependency,s=t.rightDependencyId,a=t.offsetInRightDependency,o=this.findFragmentStart(s,a),d=this.findFragmentEnd(r,i);this.documentTree.splayNode(d),this.documentTree.splayNode(o);for(var c=this.documentTree.getSuccessor(d),u=d,l=o;c!==l;){var h=this.documentTree.getFragmentIndex(u),p=this.documentTree.getFragmentIndex(l),f=this.documentTree.getFragmentIndex(c.leftDependency),g=this.documentTree.getFragmentIndex(c.rightDependency);c=f<=h&&p<=g?(e.site<c.spliceId.site?l=c:u=c,this.documentTree.getSuccessor(u)):this.documentTree.getSuccessor(c)}var m={spliceId:e,offset:k,text:n,extent:w(n),leftDependency:d,rightDependency:o,nextSplit:null,deletions:new Set};this.documentTree.insertBetween(u,l,m),this.splitTreesBySpliceId.set(B(e),new y(m))}},{key:"integrateDeletion",value:function(e,t){var n=t.leftDependencyId,r=t.offsetInLeftDependency,i=t.rightDependencyId,s=t.offsetInRightDependency,a=t.maxSeqsBySite,o=B(e);this.deletionsBySpliceId.set(o,t);for(var d=this.findFragmentStart(n,r),c=this.findFragmentEnd(i,s),u=d;;){var l=a[u.spliceId.site]||0;if(u.spliceId.seq<=l&&(this.documentTree.splayNode(u),u.deletions.add(o),this.documentTree.updateSubtreeExtent(u)),u===c)break;u=this.documentTree.getSuccessor(u)}}},{key:"integrateUndo",value:function(e,t){var n=e.spliceId,r=e.undoCount;return this.updateUndoCount(n,r,t)}},{key:"getMarkerLayersForSiteId",value:function(e){var t=this.markerLayersBySiteId.get(e);return t||(t=new Map,this.markerLayersBySiteId.set(e,t)),t}},{key:"deferMarkerUpdate",value:function(e,t,n,r){var i=r.range,s={siteId:e,layerId:t,markerId:n};this.addOperationDependency(this.deferredMarkerUpdatesByDependencyId,i.startDependencyId,s),this.addOperationDependency(this.deferredMarkerUpdatesByDependencyId,i.endDependencyId,s);var a=this.deferredMarkerUpdates.get(e);a||(a=new Map,this.deferredMarkerUpdates.set(e,a));var o=a.get(t);o||(o=new Map,a.set(t,o)),o.set(n,r)}},{key:"updateMarkersForOperations",value:function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];"markers-update"===r.type?this.integrateMarkerUpdates(t,r):"splice"===r.type&&this.integrateDeferredMarkerUpdates(t,r)}return t}},{key:"integrateMarkerUpdates",value:function(e,t){var n=t.siteId,r=t.updates,i=this.getMarkerLayersForSiteId(n);for(var s in e[n]||(e[n]={}),r){var a=r[s];s=parseInt(s);var o=i.get(s);if(a)for(var d in o||(o=new Map,i.set(s,o)),e[n][s]||(e[n][s]={}),a){var c=a[d];if(d=parseInt(d),c)c.range&&!this.canResolveLogicalRange(c.range)?this.deferMarkerUpdate(n,s,d,c):this.integrateMarkerUpdate(e,n,s,d,c);else{o.has(d)&&(o.delete(d),e[n][s][d]=null);var u=this.deferredMarkerUpdates.get(n);if(u){var l=u.get(s);l&&l.delete(d)}}}else{o&&(e[n][s]=null,i.delete(s));var h=this.deferredMarkerUpdates.get(n);h&&h.delete(s)}}}},{key:"integrateDeferredMarkerUpdates",value:function(e,t){var n=this,r=B(t.spliceId),i=this.deferredMarkerUpdatesByDependencyId.get(r);i&&(i.forEach((function(t){var r=t.siteId,i=t.layerId,s=t.markerId,a=n.deferredMarkerUpdates.get(r);if(a){var o=a.get(i);if(o){var d=o.get(s);d&&n.canResolveLogicalRange(d.range)&&n.integrateMarkerUpdate(e,r,i,s,d)}}})),this.deferredMarkerUpdatesByDependencyId.delete(r))}},{key:"integrateMarkerUpdate",value:function(e,t,n,r,i){var s=this.markerLayersBySiteId.get(t).get(n);s||(s=new Map,this.markerLayersBySiteId.get(t).set(n,s));var a=s.get(r);a=a?Object.assign({},a):{},Object.assign(a,i),Object.freeze(a),s.set(r,a),e[t]||(e[t]={}),e[t][n]||(e[t][n]={}),e[t][n][r]=Object.assign({},a),e[t][n][r].range=this.resolveLogicalRange(a.range,a.exclusive);var o=this.deferredMarkerUpdates.get(t);if(o){var d=o.get(n);d&&d.has(r)&&(d.delete(r),0===d.size&&(o.delete(n),0===o.size&&this.deferredMarkerUpdates.delete(t)))}}},{key:"snapshotFromMarkers",value:function(e){if(!e)return e;var t={};for(var n in e){var r={},i=e[n];for(var s in i){var a=Object.assign({},i[s]);a.range=this.getLogicalRange(a.range,a.exclusive),r[s]=a}t[n]=r}return t}},{key:"markersFromSnapshot",value:function(e){if(!e)return e;var t={};for(var n in e){var r={},i=e[n];for(var s in i){var a=Object.assign({},i[s]);a.range=this.resolveLogicalRange(a.range),r[s]=a}t[n]=r}return t}},{key:"updateUndoCount",value:function(e,t,n){var r=this,i=B(e),s=this.undoCountsBySpliceId.get(i)||0;if(!(t<=s)){n.set(i,s),this.undoCountsBySpliceId.set(i,t);var a=new Set;this.collectFragments(i,a),a.forEach((function(e){var t=r.isFragmentVisible(e,n);r.isFragmentVisible(e)!==t&&(r.documentTree.splayNode(e,n),r.documentTree.updateSubtreeExtent(e))}))}}},{key:"textUpdatesForOperations",value:function(e,t){for(var n=new Set,r=new Map,i=new Map,s=0;s<e.length;s++){var a=e[s],o=a.type,d=a.spliceId;if(d){var c=B(d);"splice"===o&&n.add(c),this.collectFragments(c,null,i,r)}}return this.computeChangesForFragments(i,r,t,n)}},{key:"canResolveLogicalRange",value:function(e){var t=e.startDependencyId,n=e.endDependencyId;return this.hasAppliedSplice(t)&&this.hasAppliedSplice(n)}},{key:"getLogicalRange",value:function(e,t){var n=e.start,r=e.end,i=this.findFragment(n,t),s=i.fragment,a=i.offset,o=this.findFragment(r,!t||0===I(n,r)),d=o.fragment,c=o.offset;return{startDependencyId:s.spliceId,offsetInStartDependency:a,endDependencyId:d.spliceId,offsetInEndDependency:c}}},{key:"resolveLogicalRange",value:function(e,t){var n,r,i,s,a,o,d,c=e.startDependencyId,u=e.offsetInStartDependency,l=e.endDependencyId,h=e.offsetInEndDependency;return{start:this.resolveLogicalPosition(c,u,t),end:this.resolveLogicalPosition(l,h,!t||(s=(n=e).startDependencyId,a=n.offsetInStartDependency,o=n.endDependencyId,d=n.offsetInEndDependency,i=o,(r=s).site===i.site&&r.seq===i.seq&&0===I(a,d)))}}},{key:"resolveLogicalPosition",value:function(e,t,n){var r=this.splitTreesBySpliceId.get(B(e)),i=r.findFragmentContainingOffset(t),s=x(i.offset,i.extent);n&&0===I(t,s)&&(i=r.getSuccessor(i)||i);var a=this.documentTree.getFragmentPosition(i);return this.isFragmentVisible(i)?x(a,b(t,i.offset)):a}},{key:"findLocalFragmentBoundary",value:function(e){var t=this.documentTree.findFragmentContainingPosition(e),n=t.fragment,r=t.start,i=t.end;if(I(e,i)<0){var s=this.splitTreesBySpliceId.get(B(n.spliceId));return this.splitFragment(s,n,b(e,r))}return[n,this.documentTree.getSuccessor(n)]}},{key:"splitFragment",value:function(e,t,n){var r=e.splitFragment(t,n);return this.documentTree.splitFragment(t,r),[t,r]}},{key:"findFragment",value:function(e,t){var n=this.documentTree.findFragmentContainingPosition(e),r=n.fragment,i=n.start,s=n.end,a=x(r.offset,b(e,i));return t&&0===I(e,s)&&(a=(r=this.documentTree.getSuccessor(r)).offset),{fragment:r,offset:a}}},{key:"findFragmentStart",value:function(e,t){var n=this.splitTreesBySpliceId.get(B(e)),r=n.findFragmentContainingOffset(t),i=x(r.offset,r.extent);if(0===I(r.offset,t))return r;if(0===I(i,t))return r.nextSplit;var s=this.splitFragment(n,r,b(t,r.offset));return Object(f.a)(s,2)[1]}},{key:"findFragmentEnd",value:function(e,t){var n=this.splitTreesBySpliceId.get(B(e)),r=n.findFragmentContainingOffset(t),i=x(r.offset,r.extent);if(0===I(i,t))return r;var s=this.splitFragment(n,r,b(t,r.offset));return Object(f.a)(s,1)[0]}},{key:"getText",value:function(){for(var e="",t=this.documentTree.getFragments(),n=0;n<t.length;n++){var r=t[n];this.isFragmentVisible(r)&&(e+=r.text)}return e}},{key:"collectFragments",value:function(e,t,n,r){var i=this.splitTreesBySpliceId.get(e);if(i)for(var s=i.getStart();s;)t?t.add(s):(r.set(s,this.documentTree.getFragmentPosition(s)),n.set(s,this.documentTree.getFragmentIndex(s))),s=i.getSuccessor(s);var a=this.deletionsBySpliceId.get(e);if(a)for(var o=a.leftDependencyId,d=a.offsetInLeftDependency,c=a.rightDependencyId,u=a.offsetInRightDependency,l=a.maxSeqsBySite,h=this.findFragmentStart(o,d),p=this.findFragmentEnd(c,u),f=h;;){var g=l[f.spliceId.site]||0;if(f.spliceId.seq<=g&&(t?t.add(f):(r.set(f,this.documentTree.getFragmentPosition(f)),n.set(f,this.documentTree.getFragmentIndex(f)))),f===p)break;f=this.documentTree.getSuccessor(f)}}},{key:"computeChangesForFragments",value:function(e,t,n,r){for(var i,s=Array.from(e.keys()).sort((function(t,n){return e.get(t)-e.get(n)})),a=[],o=0;o<s.length;o++){var d=s[o],c=this.isFragmentVisible(d,n,r);if(c!==this.isFragmentVisible(d)){var u=t.get(d),l=i?x(i.oldEnd,b(u,i.newEnd)):u;c?0<a.length&&0===I(i.newEnd,u)?(i.oldEnd=x(i.oldEnd,d.extent),i.oldText+=d.text):(i={oldStart:l,oldEnd:x(l,d.extent),oldText:d.text,newStart:u,newEnd:u,newText:""},a.push(i)):i&&0===I(i.newEnd,u)?(i.newEnd=x(i.newEnd,d.extent),i.newText+=d.text):(i={oldStart:l,oldEnd:l,oldText:"",newStart:u,newEnd:x(u,d.extent),newText:d.text},a.push(i))}}return a}},{key:"isFragmentVisible",value:function(e,t,n){var r,i=B(e.spliceId);return!(n&&n.has(i)||(t&&(r=t.get(i)),null==r&&(r=this.undoCountsBySpliceId.get(i)||0),0!=(1&r)||this.isFragmentDeleted(e,t,n)))}},{key:"isFragmentDeleted",value:function(e,t,n){var r=!0,i=!1,s=void 0;try{for(var a,o=e.deletions[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var d=a.value;if(!n||!n.has(d)){var c=void 0;if(t&&(c=t.get(d)),null==c&&(c=this.undoCountsBySpliceId.get(d)||0),0==(1&c))return!0}}}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return!1}},{key:"updateMaxSeqsBySite",value:function(e){var t=e.site,n=e.seq,r=this.maxSeqsBySite[t]||0;m.equal(r,n-1,"Operations from a given site must be applied in order."),this.maxSeqsBySite[t]=n,this.siteId===t&&(this.nextSequenceNumber=n+1)}}]),F);function F(e){var t=e.siteId,n=e.text,r=e.history;Object(o.a)(this,F),m(0!==t,"siteId 0 is reserved"),this.siteId=t,this.nextSequenceNumber=1,this.splitTreesBySpliceId=new Map,this.deletionsBySpliceId=new Map,this.undoCountsBySpliceId=new Map,this.markerLayersBySiteId=new Map([[this.siteId,new Map]]),this.deferredOperationsByDependencyId=new Map,this.deferredResolutionsByDependencyId=new Map,this.deferredMarkerUpdates=new Map,this.deferredMarkerUpdatesByDependencyId=new Map,this.maxSeqsBySite={},this.operations=[],this.undoStack=[],this.redoStack=[],this.nextCheckpointId=1;var i={spliceId:{site:0,seq:0},offset:k,text:"",extent:k,nextSplit:null,deletions:new Set};this.splitTreesBySpliceId.set(B(i.spliceId),new y(i));var s={spliceId:{site:0,seq:1},offset:k,text:"",extent:k,nextSplit:null,deletions:new Set};this.splitTreesBySpliceId.set(B(s.spliceId),new y(s)),this.documentTree=new v(i,s,this.isFragmentVisible.bind(this)),n?(this.setTextInRange(k,k,n),this.undoStack.length=0):r&&this.populateHistory(r)}function B(e){return e.site+"."+e.seq}function R(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=r.oldStart,s=r.oldEnd,a=r.oldText,o=r.newStart,d=r.newEnd,c=r.newText;t.push({oldStart:o,oldEnd:d,oldText:c,newStart:i,newEnd:s,newText:a})}return t}var L,E=function e(t,n,r){Object(o.a)(this,e),this.id=t,this.isBarrier=n,this.markersSnapshot=r},D=function e(t,n,r,i){Object(o.a)(this,e),this.timestamp=t,this.operations=n,this.markersSnapshotBefore=r,this.markersSnapshotAfter=i},T=O,P=n(46),C=n.n(P),M=(L=r.Component,Object(l.a)(j,L),Object(d.a)(j,[{key:"onChange",value:function(e,t){var n,r=Object.assign({},t.end);"insert"===t.action&&(r=t.start),"remove"===t.action&&(t.lines=[]),n=this.state.document.setTextInRange(t.start,r,t.lines.join("\n")),this.setState({document:this.state.document}),this.broadcast(n)}},{key:"broadcast",value:function(e){console.log(e),this.socket.emit("operations",e)}},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(p.a,{onChange:this.onChange.bind(this),name:"editor-target",value:this.state.document.getText()}),",")}}]),j);function j(e){var t,n=e.siteId;return Object(o.a)(this,j),(t=Object(c.a)(this,Object(u.a)(j).call(this))).siteId=n,t.state={document:new T({siteId:n,text:"",history:{undoStack:[],redoStack:[],nextCheckpointId:1}})},t.socket=C()("https://andy-crdt.herokuapp.com/").on("connect",(function(){console.log("connected"),t.socket.emit("operations",t.state.document.getOperations())})).on("event",(function(e){console.log("event")})).on("newSiteId",(function(e){t.state.document.maxSeqsBySite[e]=0})).on("operations",(function(e){console.log("recvd operations"),t.state.document.integrateOperations(e),t.setState({document:t.state.document})})).on("disconnect",(function(){console.log("disconnected")})),t}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)),a.a.render([i.a.createElement(M,{siteId:1}),i.a.createElement(M,{siteId:2})],document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[47,1,2]]])}]);